(()=>{"use strict";var e={609:e=>{e.exports=window.React},900:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{d(o.next(e))}catch(e){i(e)}}function l(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,l)}d((o=o.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(d){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){a.label=l[1];break}if(6===l[0]&&a.label<r[1]){a.label=r[1],r=l;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(l);break}r[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],o=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,d])}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=d(n(609)),u=function(){function e(){this.store=null}return e.prototype.initialize=function(e,t){var n=this;this.store=t,e.registerChannelHeaderButtonAction(function(){return s.default.createElement("i",{className:"icon icon-check",style:{fontSize:"18px"}})},function(){var e,o,r,i,a,l=t.getState(),d=null===(o=null===(e=l.entities)||void 0===e?void 0:e.channels)||void 0===o?void 0:o.currentChannelId,s=null===(a=null===(i=null===(r=l.entities)||void 0===r?void 0:r.channels)||void 0===i?void 0:i.channels)||void 0===a?void 0:a[d];s&&n.showTodoModal(s)},"Todo List","Open todo list for this channel"),e.registerChannelHeaderMenuAction("Todo List",function(e){var o,r,i,a=null===(i=null===(r=null===(o=t.getState().entities)||void 0===o?void 0:o.channels)||void 0===r?void 0:r.channels)||void 0===i?void 0:i[e];a&&n.showTodoModal(a)},function(){return s.default.createElement("i",{className:"icon icon-check"})})},e.prototype.showTodoModal=function(e){var t=document.createElement("div");t.id="todo-modal-root",document.body.appendChild(t);var n=window.React,o=window.ReactDOM;o.render(n.createElement(c,{channel:e,onClose:function(){o.unmountComponentAtNode(t),document.body.removeChild(t)}}),t)},e}();t.default=u;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={todos:[],groups:[],newTodoText:"",newGroupName:"",selectedGroup:"",channelMembers:[],showGroupForm:!1},t.handleEscape=function(e){"Escape"===e.key&&t.props.onClose()},t.loadTodos=function(){return a(t,void 0,void 0,function(){var e,t,n,o;return l(this,function(r){switch(r.label){case 0:if(!(e=null===(o=this.props.channel)||void 0===o?void 0:o.id))return[2];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(e))];case 2:return[4,r.sent().json()];case 3:return t=r.sent(),this.setState({todos:t.items,groups:t.groups}),[3,5];case 4:return n=r.sent(),console.error("Error loading todos:",n),[3,5];case 5:return[2]}})})},t.loadChannelMembers=function(){return a(t,void 0,void 0,function(){var e,t,n,o,r,i;return l(this,function(a){switch(a.label){case 0:if(!(e=null===(i=this.props.channel)||void 0===i?void 0:i.id))return[2];a.label=1;case 1:return a.trys.push([1,5,,6]),[4,fetch("/api/v4/channels/".concat(e,"/members"))];case 2:return[4,a.sent().json()];case 3:return t=a.sent(),n=t.map(function(e){return fetch("/api/v4/users/".concat(e.user_id)).then(function(e){return e.json()})}),[4,Promise.all(n)];case 4:return o=a.sent(),this.setState({channelMembers:o}),[3,6];case 5:return r=a.sent(),console.error("Error loading channel members:",r),[3,6];case 6:return[2]}})})},t.addTodo=function(){return a(t,void 0,void 0,function(){var e,t,n,o,r,i;return l(this,function(a){switch(a.label){case 0:if(e=this.state,t=e.newTodoText,n=e.selectedGroup,o=null===(i=this.props.channel)||void 0===i?void 0:i.id,!t.trim()||!o)return[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(o),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,completed:!1,group_id:n||void 0})})];case 2:return a.sent().ok&&(this.setState({newTodoText:""}),this.loadTodos()),[3,4];case 3:return r=a.sent(),console.error("Error adding todo:",r),[3,4];case 4:return[2]}})})},t.toggleTodo=function(e){return a(t,void 0,void 0,function(){var t,n,o;return l(this,function(r){switch(r.label){case 0:if(!(t=null===(o=this.props.channel)||void 0===o?void 0:o.id))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i(i({},e),{completed:!e.completed}))})];case 2:return r.sent(),this.loadTodos(),[3,4];case 3:return n=r.sent(),console.error("Error toggling todo:",n),[3,4];case 4:return[2]}})})},t.deleteTodo=function(e){return a(t,void 0,void 0,function(){var t,n,o;return l(this,function(r){switch(r.label){case 0:if(!(t=null===(o=this.props.channel)||void 0===o?void 0:o.id))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t,"&id=").concat(e),{method:"DELETE"})];case 2:return r.sent(),this.loadTodos(),[3,4];case 3:return n=r.sent(),console.error("Error deleting todo:",n),[3,4];case 4:return[2]}})})},t.updateTodoAssignee=function(e,n){return a(t,void 0,void 0,function(){var t,o,r;return l(this,function(a){switch(a.label){case 0:if(!(t=null===(r=this.props.channel)||void 0===r?void 0:r.id))return[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i(i({},e),{assignee_id:n}))})];case 2:return a.sent(),this.loadTodos(),[3,4];case 3:return o=a.sent(),console.error("Error updating assignee:",o),[3,4];case 4:return[2]}})})},t.addGroup=function(){return a(t,void 0,void 0,function(){var e,t,n,o;return l(this,function(r){switch(r.label){case 0:if(e=this.state.newGroupName,t=null===(o=this.props.channel)||void 0===o?void 0:o.id,!e.trim()||!t)return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/groups?channel_id=".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})})];case 2:return r.sent(),this.setState({newGroupName:"",showGroupForm:!1}),this.loadTodos(),[3,4];case 3:return n=r.sent(),console.error("Error adding group:",n),[3,4];case 4:return[2]}})})},t.deleteGroup=function(e){return a(t,void 0,void 0,function(){var t,n,o;return l(this,function(r){switch(r.label){case 0:if(!(t=null===(o=this.props.channel)||void 0===o?void 0:o.id))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/groups?channel_id=".concat(t,"&id=").concat(e),{method:"DELETE"})];case 2:return r.sent(),this.loadTodos(),[3,4];case 3:return n=r.sent(),console.error("Error deleting group:",n),[3,4];case 4:return[2]}})})},t.groupedTodos=function(e){return t.state.todos.filter(function(t){return null===e?!t.group_id:t.group_id===e})},t}return r(t,e),t.prototype.componentDidMount=function(){this.loadTodos(),this.loadChannelMembers(),document.addEventListener("keydown",this.handleEscape)},t.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.handleEscape)},t.prototype.render=function(){var e,t=this,n=this.state,o=n.newTodoText,r=n.newGroupName,i=n.selectedGroup,a=n.groups,l=n.channelMembers,d=n.showGroupForm,u=(null===(e=this.props.channel)||void 0===e?void 0:e.display_name)||"Channel";return s.default.createElement("div",{style:{position:"fixed",top:0,right:0,bottom:0,width:"400px",backgroundColor:"#fff",boxShadow:"-2px 0 8px rgba(0,0,0,0.15)",zIndex:9999,display:"flex",flexDirection:"column"}},s.default.createElement("div",{style:{padding:"16px 20px",borderBottom:"1px solid #ddd",display:"flex",justifyContent:"space-between",alignItems:"center"}},s.default.createElement("div",null,s.default.createElement("h3",{style:{margin:0,fontSize:"18px",fontWeight:600}},"Todo List"),s.default.createElement("div",{style:{fontSize:"12px",color:"#888",marginTop:"4px"}},u)),s.default.createElement("button",{onClick:this.props.onClose,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",padding:"0",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"#666"}},"×")),s.default.createElement("div",{style:{flex:1,overflowY:"auto",padding:"20px"}},s.default.createElement("div",{style:{marginBottom:"20px"}},s.default.createElement("input",{type:"text",value:o,onChange:function(e){return t.setState({newTodoText:e.target.value})},onKeyPress:function(e){return"Enter"===e.key&&t.addTodo()},placeholder:"Add new todo...",style:{width:"100%",padding:"10px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}}),s.default.createElement("select",{value:i,onChange:function(e){return t.setState({selectedGroup:e.target.value})},style:{width:"100%",padding:"10px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}},s.default.createElement("option",{value:""},"No Group"),a.map(function(e){return s.default.createElement("option",{key:e.id,value:e.id},e.name)})),s.default.createElement("button",{onClick:this.addTodo,style:{width:"100%",padding:"10px",backgroundColor:"#1c58d9",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",fontWeight:600,cursor:"pointer"}},"Add Todo")),s.default.createElement("div",{style:{marginBottom:"20px"}},s.default.createElement("button",{onClick:function(){return t.setState({showGroupForm:!d})},style:{padding:"6px 12px",fontSize:"13px",backgroundColor:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer"}},d?"Cancel":"+ Add Group"),d&&s.default.createElement("div",{style:{marginTop:"10px"}},s.default.createElement("input",{type:"text",value:r,onChange:function(e){return t.setState({newGroupName:e.target.value})},onKeyPress:function(e){return"Enter"===e.key&&t.addGroup()},placeholder:"Group name...",style:{width:"100%",padding:"8px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px"}}),s.default.createElement("button",{onClick:this.addGroup,style:{width:"100%",padding:"8px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",fontSize:"13px",cursor:"pointer"}},"Create Group"))),this.groupedTodos(null).length>0&&s.default.createElement(p,{title:"Ungrouped",todos:this.groupedTodos(null),channelMembers:l,onToggle:this.toggleTodo,onDelete:this.deleteTodo,onUpdateAssignee:this.updateTodoAssignee}),a.map(function(e){return s.default.createElement(p,{key:e.id,title:e.name,todos:t.groupedTodos(e.id),channelMembers:l,onToggle:t.toggleTodo,onDelete:t.deleteTodo,onUpdateAssignee:t.updateTodoAssignee,onDeleteGroup:function(){return t.deleteGroup(e.id)}})}),0===this.state.todos.length&&s.default.createElement("div",{style:{textAlign:"center",padding:"40px 20px",color:"#888"}},"No todos yet. Add one above to get started!")))},t}(s.default.Component),p=function(e){var t=e.title,n=e.todos,o=e.channelMembers,r=e.onToggle,i=e.onDelete,a=e.onUpdateAssignee,l=e.onDeleteGroup;return 0!==n.length||l?s.default.createElement("div",{style:{marginBottom:"20px",paddingBottom:"16px",borderBottom:"1px solid #eee"}},s.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},s.default.createElement("h4",{style:{margin:0,fontSize:"13px",fontWeight:600,textTransform:"uppercase",color:"#666",letterSpacing:"0.5px"}},t),l&&s.default.createElement("button",{onClick:l,style:{padding:"4px 8px",fontSize:"11px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"}},"Delete")),n.map(function(e){return s.default.createElement(f,{key:e.id,todo:e,channelMembers:o,onToggle:r,onDelete:i,onUpdateAssignee:a})})):null},f=function(e){var t=e.todo,n=e.channelMembers,o=e.onToggle,r=e.onDelete,i=e.onUpdateAssignee;return s.default.createElement("div",{style:{padding:"12px",backgroundColor:t.completed?"#f8f9fa":"#fff",borderRadius:"4px",marginBottom:"8px",border:"1px solid #e9ecef"}},s.default.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:"8px"}},s.default.createElement("input",{type:"checkbox",checked:t.completed,onChange:function(){return o(t)},style:{marginRight:"10px",marginTop:"3px",cursor:"pointer",flexShrink:0}}),s.default.createElement("div",{style:{flex:1,textDecoration:t.completed?"line-through":"none",color:t.completed?"#888":"#333",wordBreak:"break-word",fontSize:"14px",lineHeight:"1.5"}},t.text),s.default.createElement("button",{onClick:function(){return r(t.id)},style:{padding:"4px 8px",fontSize:"16px",color:"#dc3545",background:"none",border:"none",cursor:"pointer",flexShrink:0,marginLeft:"8px"},title:"Delete todo"},"×")),s.default.createElement("select",{value:t.assignee_id||"",onChange:function(e){return i(t,e.target.value)},style:{width:"100%",padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"3px"}},s.default.createElement("option",{value:""},"Unassigned"),n.map(function(e){return s.default.createElement("option",{key:e.id,value:e.id},"@",e.username||e.id)})))};window.registerPlugin("com.mattermost.channel-todo",new u)}},t={},n=function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(900),o=window;for(var r in n)o[r]=n[r];n.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();